<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" type="image/ico" href="https://cdn.jsdelivr.net/npm/skx@0.0.1">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,minimal-ui">
    <title>Cloudflare Data Center - Sukka's Lab</title>
    <style>
        body {
            padding: 1rem;
        }
    </style>
</head>

<body>
    <h1>Cloudflare Data Center</h1>
    <div id="cfdc-info"></div>
    <script>
        const _get = (url) =>
            fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(resp => Promise.all([resp.ok, resp.status, resp.json(), resp.headers])
            ).then(([ok, status, json, headers]) => {
                if (ok) {
                    let data = {
                        ok,
                        status,
                        data: json,
                        headers
                    }
                    return data;
                } else {
                    throw new Error(JSON.stringify(json.error));
                }
            }).catch(error => {
                throw error;
            });

        let CFDC = {
            data: [],
            current: ``,
            getInfo: () => {
                _get('cfdc.json')
                    .then(resp => {
                        CFDC.data = resp.data;
                        CFDC.current = resp.headers.get('cf-ray').split('-')[1];
                        return resp;
                    })
                    .then(resp => {
                        let dcInfo = CFDC.data[CFDC.current];
                        let html = `${CFDC.current}<br>${dcInfo.name}<br>${dcInfo.cnName}`;
                        document.getElementById('cfdc-info').innerHTML = html;
                    })
            }
        };

        CFDC.getInfo()
    </script>
</body>

</html>